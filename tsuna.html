<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Tug of War - Horizontal</title>
    <style>
        :root {
            --p1-color: #ff4757;
            --p2-color: #2e86de;
            --bg-color: #1e272e;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background-color: var(--bg-color);
            font-family: 'Avenir', 'Helvetica Neue', sans-serif;
            user-select: none; -webkit-user-select: none;
        }

        #game-container { display: flex; flex-direction: column; width: 100vw; height: 100vh; }

        .player-area {
            flex: 1; display: flex; flex-direction: column;
            justify-content: space-evenly; align-items: center;
            padding: 10px; box-sizing: border-box;
        }

        #p2-area { transform: rotate(180deg); }

        /* 中央の綱引きゲージ */
        #tug-bar-container {
            width: 100%; height: 20px; background: #333;
            position: relative; z-index: 10; overflow: hidden;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }

        #rope-gradient {
            height: 100%; width: 50%;
            background: linear-gradient(90deg, var(--p1-color), #fff, var(--p2-color));
            transition: width 0.15s cubic-bezier(0.17, 0.67, 0.83, 0.67);
            position: relative; border-right: 4px solid #fff;
        }

        /* UI要素の調整 */
        .question {
            color: white; font-size: 2.2rem; font-weight: 800;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        .options {
            display: flex; flex-direction: row; /* 横並び */
            gap: 8px; width: 95%; justify-content: center;
        }

        .btn {
            flex: 1; background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 15px 0; font-size: 1.4rem;
            border-radius: 10px; text-align: center;
            transition: transform 0.05s;
            max-width: 80px; /* ボタンが広がりすぎないよう制限 */
        }

        .p1-btn:active { background-color: var(--p1-color); transform: scale(0.95); }
        .p2-btn:active { background-color: var(--p2-color); transform: scale(0.95); }

        .stats { color: rgba(255,255,255,0.4); font-size: 0.8rem; font-weight: bold; }

        /* 勝利画面 */
        #overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100;
            flex-direction: column; justify-content: center; align-items: center; color: white;
        }
        .winner-text { font-size: 2.5rem; margin-bottom: 20px; }
        #retry-btn { padding: 12px 30px; font-size: 1.2rem; border-radius: 20px; border: none; background: #2ecc71; color: white; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="p2-area" class="player-area">
        <div id="p2-stats" class="stats">COMBO 0</div>
        <div id="p2-q" class="question">-</div>
        <div class="options">
            <div class="btn p2-btn" onclick="checkAnswer(2, 0)">?</div>
            <div class="btn p2-btn" onclick="checkAnswer(2, 1)">?</div>
            <div class="btn p2-btn" onclick="checkAnswer(2, 2)">?</div>
            <div class="btn p2-btn" onclick="checkAnswer(2, 3)">?</div>
        </div>
    </div>

    <div id="tug-bar-container">
        <div id="rope-gradient"></div>
    </div>

    <div id="p1-area" class="player-area">
        <div id="p1-q" class="question">-</div>
        <div class="options">
            <div class="btn p1-btn" onclick="checkAnswer(1, 0)">?</div>
            <div class="btn p1-btn" onclick="checkAnswer(1, 1)">?</div>
            <div class="btn p1-btn" onclick="checkAnswer(1, 2)">?</div>
            <div class="btn p1-btn" onclick="checkAnswer(1, 3)">?</div>
        </div>
        <div id="p1-stats" class="stats">COMBO 0</div>
    </div>
</div>

<div id="overlay">
    <div id="winner-display" class="winner-text">WINNER</div>
    <button id="retry-btn" onclick="resetGame()">REMATCH</button>
</div>

<script>
    let ropePos = 50; 
    const players = {
        1: { q: {}, combo: 0, startTime: 0 },
        2: { q: {}, combo: 0, startTime: 0 }
    };

    function generateQuestion() {
        const ops = ['+', '-', '×'];
        const op = ops[Math.floor(Math.random() * ops.length)];
        let a, b, ans;

        if (op === '×') {
            a = Math.floor(Math.random() * 9) + 2;
            b = Math.floor(Math.random() * 9) + 2;
            ans = a * b;
        } else {
            a = Math.floor(Math.random() * 40) + 10;
            b = Math.floor(Math.random() * 40) + 10;
            ans = (op === '+') ? a + b : (a > b ? a - b : b - a);
            if (op === '-' && b > a) { let temp = a; a = b; b = temp; }
        }

        let choices = [ans];
        while (choices.length < 4) {
            let diff = Math.floor(Math.random() * 10) - 5;
            let wrong = ans + (diff === 0 ? 2 : diff);
            if (!choices.includes(wrong) && wrong > 0) choices.push(wrong);
        }
        return { text: `${a}${op}${b}`, ans, choices: choices.sort(() => Math.random() - 0.5) };
    }

    function updateUI(pId) {
        const p = players[pId];
        p.q = generateQuestion();
        p.startTime = Date.now();
        document.getElementById(`p${pId}-q`).innerText = p.q.text;
        const btns = document.querySelectorAll(`#p${pId}-area .btn`);
        btns.forEach((btn, i) => {
            btn.innerText = p.q.choices[i];
            btn.style.opacity = "1";
        });
        document.getElementById(`p${pId}-stats`).innerText = `COMBO ${p.combo}`;
    }

    function checkAnswer(pId, idx) {
        const p = players[pId];
        if (p.q.choices[idx] === p.q.ans) {
            const sec = (Date.now() - p.startTime) / 1000;
            const boost = Math.max(0.5, 2.5 - sec); 
            p.combo++;
            const power = (0.8 + (p.combo * 0.2)) * boost;
            ropePos += (pId === 1 ? power : -power);
            updateRope();
            if (ropePos >= 100 || ropePos <= 0) endGame(pId === 1 ? "PLAYER 1" : "PLAYER 2");
        } else {
            p.combo = 0;
            const btns = document.querySelectorAll(`#p${pId}-area .btn`);
            btns.forEach(b => b.style.opacity = "0.2");
        }
        updateUI(pId);
    }

    function updateRope() {
        document.getElementById('rope-gradient').style.width = `${ropePos}%`;
    }

    function endGame(winner) {
        document.getElementById('winner-display').innerText = winner + " WINS!";
        document.getElementById('overlay').style.display = 'flex';
    }

    function resetGame() {
        ropePos = 50;
        players[1].combo = 0; players[2].combo = 0;
        updateRope(); updateUI(1); updateUI(2);
        document.getElementById('overlay').style.display = 'none';
    }

    resetGame();
</script>
</body>
</html>

<!DOCTYPE html><html lang="ja"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>„É©„Ç∞„Éì„Éº„Ç´„Éº„Éâ„Ç≤„Éº„É†</title>    <style>        * {            margin: 0;            padding: 0;            box-sizing: border-box;        }
        body {            font-family: 'Arial', sans-serif;            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);            min-height: 100vh;            display: flex;            flex-direction: column;            align-items: center;            padding: 8px;            color: #333;            font-size: 14px;        }
        /* „Éó„É¨„Ç§„É§„ÉºËâ≤ÂÆöÁæ© */        :root {            --player-color: #1976D2; /* Èùí */            --player-color-bg: #64B5F6; /* ÈùíËÉåÊôØ */            --cpu-color: #F57C00; /* „Ç™„É¨„É≥„Ç∏ */            --cpu-color-bg: #FFB74D; /* „Ç™„É¨„É≥„Ç∏ËÉåÊôØ */            --white-bg: #FFFFFF; /* ÁôΩËÉåÊôØ */        }
        /* „Çπ„Çø„Éº„ÉàÁîªÈù¢ */        #startScreen {            text-align: center;            padding: 25px 30px;            background: white;            border-radius: 16px;            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);            border: 3px solid #1976D2;        }
        #startScreen h1 {            font-size: 28px;            margin-bottom: 20px;            color: #1976D2;            font-weight: bold;        }
        #startScreen label {            font-size: 14px;            margin-bottom: 8px;            display: block;            color: #333;            font-weight: 500;        }
        #startScreen select {            font-size: 14px;            padding: 8px 15px;            margin-bottom: 15px;            border-radius: 8px;            border: 2px solid #1976D2;            background: white;            cursor: pointer;            color: #333;        }
        #startScreen button {            font-size: 17px;            padding: 12px 35px;            background: var(--player-color);            color: white;            border: none;            border-radius: 12px;            cursor: pointer;            transition: all 0.3s;            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);            font-weight: bold;        }
        #startScreen button:hover {            transform: translateY(-2px);            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);        }
        /* „Ç≤„Éº„É†ÁîªÈù¢ */        #gameScreen {            display: none;            width: 100%;            max-width: 100vw;        }
        /* „Çπ„Ç≥„Ç¢„Éú„Éº„Éâ */        .scoreboard {            display: flex;            justify-content: space-between;            gap: 8px;            margin-bottom: 8px;        }
        .player-score {            text-align: center;            flex: 1;            padding: 6px 10px;            border-radius: 8px;            border: 2px solid transparent;            transition: all 0.3s;            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);        }
        .player-score.player-side {            background: var(--player-color-bg);            border-color: var(--player-color);        }
        .player-score.cpu-side {            background: var(--cpu-color-bg);            border-color: var(--cpu-color);        }
        .player-score.active {            box-shadow: 0 0 15px var(--player-color), 0 3px 10px rgba(0, 0, 0, 0.2);            transform: scale(1.03);        }
        .player-score.cpu-side.active {            box-shadow: 0 0 15px var(--cpu-color), 0 3px 10px rgba(0, 0, 0, 0.2);        }
        .player-score h2 {            font-size: 11px;            margin-bottom: 2px;            color: white;            font-weight: bold;            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);        }
        .player-score .score {            font-size: 16px;            font-weight: bold;            color: white;            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);        }
        /* „Éï„Ç£„Éº„É´„Éâ */        .field-container {            background: white;            border-radius: 10px;            padding: 12px;            margin-bottom: 8px;            position: relative;            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);            border: 2px solid #4CAF50;        }
        .field {            background: linear-gradient(90deg,                 #81C784 0%, #81C784 49%,                 #fff 49%, #fff 51%,                 #81C784 51%, #81C784 100%);            height: 45px;            position: relative;            border-radius: 8px;            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.15);            border: 2px solid #4CAF50;        }
        .field-markers {            display: flex;            justify-content: space-between;            margin-top: 6px;            color: #2E7D32;            font-weight: bold;            font-size: 11px;            position: relative;        }
        .ball-position {            position: absolute;            top: 50%;            transform: translate(-50%, -50%);            font-size: 24px;            transition: left 0.5s ease-out;            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.6));        }
        /* ÂÆüÊ≥Å„É≠„Ç∞ */        .commentary {            background: var(--white-bg);            border-radius: 8px;            padding: 8px;            margin-bottom: 8px;            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);        }
        .commentary-log {            max-height: 80px;            overflow-y: auto;            display: flex;            flex-direction: column;        }
        .commentary-item {            padding: 4px 8px;            margin-bottom: 3px;            background: rgba(0, 0, 0, 0.03);            border-radius: 4px;            font-size: 11px;            border-left: 3px solid #888;            color: #333;        }
        .commentary-item.player {            border-left-color: var(--player-color);            background: rgba(25, 118, 210, 0.1);        }
        .commentary-item.cpu {            border-left-color: var(--cpu-color);            background: rgba(245, 124, 0, 0.1);        }
        /* „Ç≠„ÉÉ„ÇØ„Ç™„Éï„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó */        .kickoff-popup {            padding: 24px;            background: white;            border-radius: 16px;            text-align: center;            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);            min-width: 280px;            max-width: 90vw;            display: flex;            flex-direction: column;            align-items: center;            justify-content: center;        }
        .kickoff-popup.player-kickoff {            border: 4px solid var(--player-color);        }
        .kickoff-popup.cpu-kickoff {            border: 4px solid var(--cpu-color);        }
        .kickoff-header {            margin-bottom: 15px;            padding: 10px;            border-radius: 8px;            font-size: 15px;            font-weight: bold;            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);        }
        .kickoff-header.player-kickoff {            background: var(--player-color);            color: white;            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);        }
        .kickoff-header.cpu-kickoff {            background: var(--cpu-color);            color: white;            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);        }
        .slot-container {            display: flex;            justify-content: center;            gap: 8px;            margin-bottom: 12px;        }
        .slot-number {            width: 55px;            height: 70px;            background: #f5f5f5;            color: #1e5128;            display: flex;            align-items: center;            justify-content: center;            font-size: 36px;            font-weight: bold;            border-radius: 10px;            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);            border: 2px solid #ccc;        }
        .kickoff-button {            font-size: 17px;            padding: 12px 35px;            background: var(--player-color);            color: white;            border: none;            border-radius: 12px;            cursor: pointer;            transition: all 0.3s;            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);            font-weight: bold;        }
        .kickoff-button:hover:not(:disabled) {            transform: translateY(-2px);            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);        }
        .kickoff-button:disabled {            background: #ccc;            cursor: not-allowed;            opacity: 0.6;        }
        /* „Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥„Ç≠„ÉÉ„ÇØ „Éú„Çø„É≥ */
        .conversion-button {
            font-size: 18px;            padding: 12px 40px;            background: #FFD700;            color: white;            border: none;            border-radius: 12px;            cursor: pointer;            transition: all 0.3s;            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);            font-weight: bold;            margin-top: 15px;        }
        .conversion-button:hover:not(:disabled) {            transform: translateY(-2px);            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);        }
        .conversion-button:disabled {            background: #ccc;            cursor: not-allowed;            opacity: 0.6;        }
        /* „Ç´„Éº„ÉâÈñ¢ÈÄ£ */        .cards-container {            border-radius: 8px;            padding: 8px;            margin-bottom: 8px;            transition: all 0.3s;            border: 2px solid transparent;            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);        }
        .cards-container.player-turn {            background: var(--player-color-bg);            border-color: var(--player-color);        }
        .cards-container.cpu-turn {            background: var(--cpu-color-bg);            border-color: var(--cpu-color);        }
        .cards-container h3 {            margin-bottom: 6px;            font-size: 13px;            font-weight: bold;            color: #fff;            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);        }
        .cards-container h3.right {            text-align: right;        }
        .hand {            display: flex;            gap: 2px;            justify-content: flex-start;            flex-wrap: nowrap;            min-height: 46px;        }
        .card {            min-width: 46px;            width: 46px;            height: 46px;            background: white;            border-radius: 6px;            padding: 4px;            transition: all 0.5s;            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);            display: flex;            align-items: center;            justify-content: center;            position: relative;        }
        .card.using {            animation: cardGlow 0.5s ease-in-out;            border: 4px solid #ffd700;        }
        .card.disappearing {            animation: cardDisappear 0.5s ease-out forwards;        }
        .card.appearing {            animation: cardSlideIn 0.5s ease-out;        }
        @keyframes cardGlow {            0%, 100% { box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }            50% { box-shadow: 0 0 30px #ffd700, 0 0 50px #ffd700; }        }
        @keyframes cardDisappear {            0% {                 opacity: 1;                 transform: scale(1);             }            100% {                 opacity: 0;                 transform: scale(0) translateY(-30px);                width: 0;                min-width: 0;                margin-right: -4px;                padding: 0;            }        }
        @keyframes cardSlideIn {            0% {                 opacity: 0;                 transform: translateX(0) scale(1);            }            100% {                 opacity: 1;                 transform: translateX(0) scale(1);            }        }
        .card-position {            font-size: 11px;            font-weight: bold;            color: #1e5128;            line-height: 1;        }                .card-position.kick {            color: #FF1493;            font-size: 12px;        }
        /* ÂΩπÈÅ∏Êäû */        .combinations {            border-radius: 8px;            padding: 8px;            margin-bottom: 8px;            border: 2px solid transparent;            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);            background: var(--white-bg);        }
        .combinations.player-turn {            border-color: var(--player-color);        }
        .combinations.cpu-turn {            border-color: var(--cpu-color);        }
        .combinations h3 {            margin-bottom: 6px;            font-size: 13px;            font-weight: bold;        }
        .combinations.player-turn h3 {            color: var(--player-color);        }
        .combinations.cpu-turn h3 {            color: var(--cpu-color);        }
        .no-combos-message {            padding: 8px;            text-align: center;            background: rgba(0, 0, 0, 0.05);            border-radius: 6px;            font-size: 11px;            line-height: 1.4;            margin-bottom: 6px;            font-weight: bold;        }
        .shuffle-button {            width: 100%;            font-size: 14px;            padding: 12px;            background: var(--player-color);            color: white;            border: none;            border-radius: 8px;            cursor: pointer;            transition: all 0.3s;            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);            font-weight: bold;        }
        .combination-list {            display: flex;            flex-direction: column;            gap: 4px;            max-height: 150px;            overflow-y: auto;        }
        .combination-item {            background: rgba(0, 0, 0, 0.03);            padding: 8px;            border-radius: 6px;            cursor: pointer;            transition: all 0.3s;            border: 2px solid transparent;            color: #333;        }
        .combination-item:hover {            background: rgba(0, 0, 0, 0.08);        }
        .combination-item.selected {            background: var(--player-color) !important;            border-color: var(--player-color) !important;            border-width: 3px !important;            color: white !important;        }
        .combination-name {            font-size: 12px;            font-weight: bold;            margin-bottom: 2px;            display: inline;        }
        .combination-cards {            font-size: 12px;            color: #1e5128;            margin-bottom: 2px;            display: inline;            margin: 0 6px;            font-weight: bold;        }
        /* „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó */        .popup-overlay {            display: none;            position: fixed;            top: 0;            left: 0;            width: 100%;            height: 100%;            background: rgba(0, 0, 0, 0.8);            z-index: 1000;            justify-content: center;            align-items: center;            backdrop-filter: blur(4px);        }
        .popup-overlay.show {            display: flex;        }
        .popup {            background: white;            padding: 25px 35px;            border-radius: 16px;            text-align: center;            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);            animation: popupAppear 0.3s ease-out;            max-width: 90vw;            border: 3px solid #1e5128;            margin: 0 auto;        }
        .popup.try.player-try {            background: var(--player-color);            color: white;            border-color: var(--player-color);        }
        .popup.try.cpu-try {            background: var(--cpu-color);            color: white;            border-color: var(--cpu-color);        }
        .popup.turnover {            background: #9E9E9E;            color: white;            border-color: #616161;        }
        @keyframes popupAppear {            0% { transform: scale(0.5); opacity: 0; }            100% { transform: scale(1); opacity: 1; }        }
        #victoryScreen {            display: none;            text-align: center;            padding: 35px;            background: white;            border-radius: 16px;            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);            border: 4px solid #FFD700;        }
        #victoryScreen h1 {            font-size: 32px;            margin-bottom: 25px;            color: #FF8C00;            font-weight: bold;        }
        #victoryScreen button {            font-size: 17px;            padding: 12px 35px;            background: var(--player-color);            color: white;            border: none;            border-radius: 12px;            cursor: pointer;            font-weight: bold;        }
    </style></head><body>
    <div id="startScreen">
        <h1>„É©„Ç∞„Éì„Éº„Ç´„Éº„Éâ„Ç≤„Éº„É†</h1>
        <label for="tryCount">ÁõÆÊ®ôÂæóÁÇπ„ÇíÈÅ∏Êäû:</label>
        <select id="tryCount">
            <option value="10">10ÁÇπÂÖàÂèñ</option>
            <option value="20" selected>20ÁÇπÂÖàÂèñ</option>
        </select>
        <br>
        <button onclick="startGame()">„Ç≤„Éº„É†ÈñãÂßã</button>
    </div>
    <div id="gameScreen">
        <div class="scoreboard">
            <div class="player-score player-side" id="playerScoreBoard">
                <h2>„Éó„É¨„Ç§„É§„Éº</h2>
                <div class="score"><span id="playerScore">0</span> ÁÇπ</div>
            </div>
            <div class="player-score cpu-side" id="cpuScoreBoard">
                <h2>CPU</h2>
                <div class="score"><span id="cpuScore">0</span> ÁÇπ</div>
            </div>
        </div>
        <div class="field-container">
            <div class="field">
                <div class="ball-position" id="ballPosition">üèâ</div>
            </div>
            <div class="field-markers">
                <span>„Éà„É©„Ç§</span>
                <span style="position: absolute; left: 50%; transform: translateX(-50%);">HL</span>
                <span>„Éà„É©„Ç§</span>
            </div>
        </div>
        <div class="commentary">
            <div class="commentary-log" id="commentaryLog"></div>
        </div>
        <div class="cards-container" id="cardsContainer">
            <h3 id="handTitle">„ÅÇ„Å™„Åü„ÅÆÊâãÊú≠</h3>
            <div class="hand" id="hand"></div>
        </div>
        <div class="combinations" id="combinationsPanel" style="display: none;">
            <h3>‰Ωø„Åà„ÇãÊäÄ</h3>
            <div class="combination-list" id="combinationList"></div>
        </div>
    </div>
    <div class="popup-overlay" id="popupOverlay" onclick="closePopup()">
        <div class="popup" id="popup" onclick="event.stopPropagation()">
            <h2 id="popupTitle"></h2>
            <p id="popupMessage"></p>
            <div id="popupContent"></div>
        </div>
    </div>
    <div id="victoryScreen">
        <h1 id="victoryMessage"></h1>
        <button onclick="location.reload()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§</button>
    </div>

    <script>
        const POSITIONS = { 'PR': '„Éó„É≠„ÉÉ„Éó', 'HO': '„Éï„ÉÉ„Ç´„Éº', 'LO': '„É≠„ÉÉ„ÇØ', 'FL': '„Éï„É©„É≥„Ç´„Éº', 'No.8': '„Éä„É≥„Éê„Éº„Ç®„Ç§„Éà', 'SH': '„Çπ„ÇØ„É©„É†„Éè„Éº„Éï', 'SO': '„Çπ„Çø„É≥„Éâ„Ç™„Éï', 'CTB': '„Çª„É≥„Çø„Éº', 'WTB': '„Ç¶„Ç§„É≥„Ç∞', 'FB': '„Éï„É´„Éê„ÉÉ„ÇØ', 'KICK': 'KICK' };

        const COMBINATIONS = [
            { name: '„Ç¥„É™„Ç¥„É™„Çπ„ÇØ„É©„É†', cards: ['PR', 'HO', 'PR'], distance: 8 },
            { name: '„ÉÑ„Ç§„É≥„Çø„ÉØ„Éº', cards: ['HO', 'LO', 'LO'], distance: 8 },
            { name: 'ÊäúÁæ§„ÅÆÊ©üÂãïÂäõ', cards: ['FL', 'No.8', 'FL'], distance: 9 },
            { name: '„Çø„Ç§„Éà„Éï„Ç°„Ç§„Éñ', cards: ['PR', 'HO', 'LO'], distance: 8 },
            { name: 'ÈªÑÈáë„ÅÆ„Éï„É≠„É≥„Éà„Çπ„É™„Éº', cards: ['SO', 'CTB', 'CTB'], distance: 9 },
            { name: 'Â§ßÂ§ñÂ±ïÈñã', cards: ['SO', 'CTB', 'WTB'], distance: 10 },
            { name: 'Èü≥ÈÄü„ÅÆ„Éê„ÉÉ„ÇØ„Çπ„É™„Éº', cards: ['WTB', 'FB', 'WTB'], distance: 10 },
            { name: '„Éï„É´„Éê„ÉÉ„ÇØ„É©„Ç§„É≥ÂèÇÂä†', cards: ['SH', 'SO', 'FB'], distance: 9 },
            { name: '„Çπ„ÇØ„É©„É†„Çµ„Ç§„Éâ„Ç¢„Çø„ÉÉ„ÇØ', cards: ['FL', 'No.8', 'SH'], distance: 9 },
            { name: 'Ë∂ÖÈÄü„Éñ„É¨„Ç§„ÇØ„ÉÄ„Ç¶„É≥', cards: ['FL', 'SH', 'CTB'], distance: 10 },
            { name: '„Ç®„ÉÉ„Ç∏„Ç¢„Çø„ÉÉ„ÇØ', cards: ['FL', 'No.8', 'WTB'], distance: 10 },
            { name: '9„Ç∑„Çß„Ç§„Éó', cards: ['PR', 'HO', 'LO', 'SH'], distance: 13 },
            { name: '„Çπ„ÇØ„É©„É†&„Éâ„É©„Ç§„Éñ', cards: ['PR', 'HO', 'LO', 'No.8'], distance: 14 },
            { name: '„É©„Ç§„É≥„Ç¢„Ç¶„Éà„É¢„Éº„É´', cards: ['HO', 'LO', 'FL', 'No.8'], distance: 14 },
            { name: '„Éï„Ç©„ÉØ„Éº„Éâ„É©„ÉÉ„Ç∑„É•', cards: ['PR', 'FL', 'FL', 'No.8'], distance: 13 },
            { name: 'ËèØÈ∫ó„Å™„Éë„Çπ„ÉØ„Éº„ÇØ', cards: ['SO', 'CTB', 'WTB', 'FB'], distance: 16 },
            { name: '„Çª„É≥„Çø„ÉºÁÑ°Âèå', cards: ['SH', 'SO', 'CTB', 'CTB'], distance: 15 },
            { name: '„ÉØ„Ç§„ÉâÂ±ïÈñã', cards: ['SH', 'CTB', 'WTB', 'FB'], distance: 15 },
            { name: '„Ç≠„ÉÉ„ÇØ„Éë„Çπ', cards: ['SO', 'SO', 'WTB', 'FB'], distance: 16 },
            { name: '„ÇØ„Ç§„ÉÉ„ÇØ„É™„Çµ„Ç§„ÇØ„É´', cards: ['FL', 'No.8', 'SH', 'SO'], distance: 15 },
            { name: '„Éñ„É©„Ç§„É≥„Éâ„Çµ„Ç§„Éâ', cards: ['PR', 'FL', 'SH', 'WTB'], distance: 14 },
            { name: '„Éö„Éç„Éà„É¨„Éº„Ç∑„Éß„É≥', cards: ['LO', 'No.8', 'CTB', 'WTB'], distance: 16 },
            { name: '10„Ç∑„Çß„Ç§„Éó', cards: ['HO', 'LO', 'FL', 'SO'], distance: 17 },
            { name: '„Éï„Ç©„ÉØ„Éº„ÉâÂà∂Âúß', cards: ['PR', 'HO', 'LO', 'FL', 'No.8'], distance: 21 },
            { name: '„Çπ„Éº„Éë„Éº„Çø„Ç§„Éà„Éï„Ç°„Ç§„Éñ', cards: ['PR', 'PR', 'HO', 'LO', 'LO'], distance: 20 },
            { name: '„Éë„Éº„Éï„Çß„ÇØ„Éà„É©„Ç§„É≥', cards: ['SH', 'SO', 'CTB', 'WTB', 'FB'], distance: 23 },
            { name: 'Ë°®„Å®Ë£è„ÅÆ„Çπ„Éº„Éë„Éº„É†„Éº„Éñ', cards: ['SH', 'SO', 'CTB', 'CTB', 'WTB'], distance: 22 },
            { name: '„ÉÅ„Éº„É†„ÅÆËÉåÈ™®', cards: ['HO', 'No.8', 'SH', 'SO', 'FB'], distance: 22 },
            { name: 'Ë™∞„Åß„ÇÇ„Ç≤„Ç§„É≥„Åß„Åç„ÇãÁî∑„Åü„Å°', cards: ['PR', 'LO', 'SH', 'CTB', 'WTB'], distance: 21 },
            { name: 'Â±ÄÈù¢„ÇíÂ§â„Åà„ÇãÁî∑ÈÅî', cards: ['FL', 'No.8', 'SH', 'SO', 'FB'], distance: 24 },
            { name: '„Éè„Ç§„Éú„Éº„É´„Ç≠„É£„ÉÉ„ÉÅ', cards: ['CTB', 'CTB', 'WTB', 'WTB'], distance: 0 }
        ];

        let gameState = {
            targetTries: 20, playerScore: 0, cpuScore: 0, ballPosition: 50,
            currentTurn: 'player', playerHand: [], cpuHand: [], 
            commentary: [], hasShuffled: false, usedKick: false, slotInterval: null
        };

        function showPopup(title, message, isTry = false, contentHTML = '', isTurnover = false) {
            const overlay = document.getElementById('popupOverlay');
            const popup = document.getElementById('popup');
            popup.className = 'popup';
            if (isTry) popup.classList.add('try');
            if (isTurnover) popup.classList.add('turnover');
            document.getElementById('popupTitle').textContent = title;
            document.getElementById('popupMessage').textContent = message;
            document.getElementById('popupContent').innerHTML = contentHTML;
            overlay.classList.add('show');
        }

        function closePopup() { document.getElementById('popupOverlay').classList.remove('show'); }

        function addCommentary(text, type = 'system') {
            gameState.commentary.push({ text, type });
            if (gameState.commentary.length > 5) gameState.commentary.shift();
            const log = document.getElementById('commentaryLog');
            log.innerHTML = gameState.commentary.map(i => `<div class="commentary-item ${i.type}">${i.text}</div>`).join('');
            log.scrollTop = log.scrollHeight;
        }

        function drawCard() {
            const normal = ['PR', 'HO', 'LO', 'FL', 'No.8', 'SH', 'SO', 'CTB', 'WTB', 'FB'];
            return Math.random() < 0.2 ? 'KICK' : normal[Math.floor(Math.random() * 10)];
        }

        function refillHand(hand) { while (hand.length < 7) hand.push(drawCard()); }

        function renderHand() {
            const handDiv = document.getElementById('hand');
            const hand = gameState.currentTurn === 'player' ? gameState.playerHand : gameState.cpuHand;
            handDiv.innerHTML = hand.map(card => `<div class="card"><div class="card-position ${card === 'KICK' ? 'kick' : ''}">${card}</div></div>`).join('');
            document.getElementById('cardsContainer').className = `cards-container ${gameState.currentTurn}-turn`;
            document.getElementById('handTitle').textContent = gameState.currentTurn === 'player' ? '„ÅÇ„Å™„Åü„ÅÆÊâãÊú≠' : 'Áõ∏Êâã„ÅÆÊâãÊú≠';
        }

        function startGame() {
            gameState.targetTries = parseInt(document.getElementById('tryCount').value);
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            refillHand(gameState.playerHand); refillHand(gameState.cpuHand);
            startKickoff();
        }

        function startKickoff() {
            const isPlayer = gameState.currentTurn === 'player';
            const headerText = isPlayer ? '„ÅÇ„Å™„Åü„ÅÆ„Ç≠„ÉÉ„ÇØ„Ç™„Éï' : 'CPU„ÅÆ„Ç≠„ÉÉ„ÇØ„Ç™„Éï';
            const slotHTML = `<div class="kickoff-popup ${isPlayer?'player-kickoff':'cpu-kickoff'}"><div class="kickoff-header ${isPlayer?'player-kickoff':'cpu-kickoff'}">${headerText}</div><div class="slot-container"><div class="slot-number" id="s1">1</div><div class="slot-number" id="s2">0</div></div>${isPlayer?'<button class="kickoff-button" id="kickBtn">„Ç≠„ÉÉ„ÇØÔºÅ</button>':'<p>ÂæÖÊ©ü‰∏≠...</p>'}</div>`;
            showPopup('', '', false, slotHTML);
            
            gameState.slotInterval = setInterval(() => {
                const n = Math.floor(Math.random()*40)+10;
                document.getElementById('s1').textContent = Math.floor(n/10);
                document.getElementById('s2').textContent = n%10;
            }, 100);

            if(isPlayer) document.getElementById('kickBtn').onclick = stopKickoff;
            else setTimeout(stopKickoff, 2000);
        }

        function stopKickoff() {
            clearInterval(gameState.slotInterval);
            const dist = parseInt(document.getElementById('s1').textContent)*10 + parseInt(document.getElementById('s2').textContent);
            setTimeout(() => {
                closePopup();
                if (gameState.currentTurn === 'player') { gameState.ballPosition += dist; gameState.currentTurn = 'cpu'; }
                else { gameState.ballPosition -= dist; gameState.currentTurn = 'player'; }
                addCommentary(`${gameState.currentTurn==='cpu'?'„Éó„É¨„Ç§„É§„Éº':'CPU'}„Åå${dist}m„Ç≠„ÉÉ„ÇØÔºÅ`, gameState.currentTurn==='cpu'?'player':'cpu');
                updateUI(); startTurn();
            }, 1000);
        }

        function startTurn() { renderHand(); if (gameState.currentTurn === 'cpu') cpuLogic(); else checkCombinations(); }

        // --- ‰øÆÊ≠£ÁÇπ1: KICKÂà§ÂÆö„ÅÆÁ¢∫ÂÆüÂåñ („Éó„É¨„Ç§„É§„Éº/CPU/„Å®„Å™„Çä„ÅÆ‰∫∫ ÂÖ±ÈÄö) ---
        function findAllCombinations(hand) {
            const found = [];
            // KICK„Ç´„Éº„Éâ„ÅåÊâãÊú≠„Å´„ÅÇ„Çå„Å∞„ÄÅÊúÄÂÑ™ÂÖà„Åß„ÄåÊäÄ„Äç„Å®„Åó„Å¶ÁôªÈå≤
            if (hand.includes('KICK')) {
                found.push({ name: 'KICK', cards: ['KICK'], distance: 35, isKick: true });
            }
            COMBINATIONS.forEach(combo => {
                const needed = [...combo.cards], available = [...hand], used = [];
                let canMake = true;
                for (let card of needed) {
                    const idx = available.indexOf(card);
                    if (idx > -1) { used.push(available[idx]); available.splice(idx, 1); }
                    else { canMake = false; break; }
                }
                if (canMake) found.push({ ...combo, usedCards: used });
            });
            return found;
        }

        // --- ‰øÆÊ≠£ÁÇπ2 & 3: „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅÆÁµ±‰∏Ä„Å®KICKÂæå„ÅÆ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÊºîÂá∫ ---
        function executeCombination(combo) {
            const cardElements = document.querySelectorAll('#hand .card');
            const hand = gameState.currentTurn === 'player' ? gameState.playerHand : gameState.cpuHand;
            const usedIndices = [];
            
            // ÊâãÊú≠„Åã„Çâ‰ΩøÁî®„Åô„Çã„Ç´„Éº„Éâ„ÇíÁâπÂÆö„Åó„ÄÅ„Åæ„Åö„ÄåÂÖâ„Çâ„Åõ„Çã„Äç
            [...combo.cards].forEach(card => {
                for (let i = 0; i < hand.length; i++) {
                    if (hand[i] === card && !usedIndices.includes(i)) {
                        usedIndices.push(i);
                        cardElements[i].classList.add('using');
                        break;
                    }
                }
            });

            // 0.5ÁßíÂÖâ„Å£„ÅüÂæå„ÄÅ„Ç´„Éº„Éâ„Çí„ÄåÂ∞è„Åï„Åè„Åó„Å¶Ê∂à„Åô„Äç„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíÈñãÂßã
            setTimeout(() => {
                usedIndices.forEach(idx => cardElements[idx].classList.add('disappearing'));
                
                // „Åï„Çâ„Å´0.5ÁßíÔºà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆå‰∫ÜÔºâÂæÖ„Å£„Å¶„Åã„Çâ„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
                setTimeout(() => {
                    usedIndices.sort((a,b) => b-a).forEach(idx => hand.splice(idx, 1));
                    const move = gameState.currentTurn === 'player' ? combo.distance : -combo.distance;
                    gameState.ballPosition += move;
                    
                    if (combo.isKick) gameState.usedKick = true;
                    refillHand(hand);
                    updateUI();
                    renderHand();

                    if (!checkTry()) {
                        if (combo.isKick) {
                            // KICKÂÆüË°åÂæå„ÅÆ„Çø„Éº„É≥„Ç™„Éº„Éê„ÉºÊºîÂá∫
                            gameState.usedKick = false;
                            const kickerName = gameState.currentTurn === 'player' ? '„Éó„É¨„Ç§„É§„Éº' : 'CPU';
                            showPopup('„Çø„Éº„É≥„Ç™„Éº„Éê„Éº', `${kickerName}„ÅÆ„Ç≠„ÉÉ„ÇØÔºÅÊîªÂÆà‰∫§‰ª£„Åß„Åô`, false, '', true);
                            setTimeout(() => { closePopup(); switchTurn(); }, 2000);
                        } else {
                            const next = findAllCombinations(hand);
                            if (next.length > 0) {
                                if (gameState.currentTurn === 'player') checkCombinations(); else cpuLogic();
                            } else {
                                // ÊäÄ„Åå„Å™„ÅÑÂ†¥Âêà
                                const activeName = gameState.currentTurn === 'player' ? '„ÅÇ„Å™„Åü' : 'CPU';
                                showPopup('„Çø„Éº„É≥„Ç™„Éº„Éê„Éº', `${activeName}„ÅØÂá∫„Åõ„ÇãÊäÄ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì`, false, '', true);
                                setTimeout(() => { closePopup(); switchTurn(); }, 2000);
                            }
                        }
                    }
                }, 500); // Ê∂à„Åà„Çã„ÅÆ„ÇíÂæÖ„Å§
            }, 500); // ÂÖâ„Çã„ÅÆ„ÇíÂæÖ„Å§
        }

        function cpuLogic() {
            const combos = findAllCombinations(gameState.cpuHand);
            if (combos.length > 0) {
                const best = combos.sort((a,b) => b.distance - a.distance)[0];
                setTimeout(() => executeCombination(best), 1000);
            } else {
                showPopup('„Çø„Éº„É≥„Ç™„Éº„Éê„Éº', 'CPU„ÅØÊäÄ„ÅåÂá∫„Åõ„Åæ„Åõ„Çì', false, '', true);
                setTimeout(() => { closePopup(); switchTurn(); }, 2000);
            }
        }

        function checkCombinations() {
            const combos = findAllCombinations(gameState.playerHand);
            const panel = document.getElementById('combinationsPanel'), list = document.getElementById('combinationList');
            panel.style.display = 'block';
            list.innerHTML = combos.length > 0 ? 
                combos.map(c => `<div class="combination-item" onclick="executeCombination(${JSON.stringify(c).replace(/"/g, '&quot;')})"><span class="combination-name">${c.name}</span><span class="combination-cards">${c.cards.join('+')}</span></div>`).join('') :
                `<div class="no-combos-message">ÊäÄ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div><button class="shuffle-button" onclick="shuffleHand()">„Ç∑„É£„ÉÉ„Éï„É´</button>`;
        }

        function shuffleHand() { gameState.playerHand = []; refillHand(gameState.playerHand); startTurn(); }

        function checkTry() {
            if (gameState.ballPosition >= 100 || gameState.ballPosition <= 0) {
                const winner = gameState.ballPosition >= 100 ? 'player' : 'cpu';
                if (winner === 'player') gameState.playerScore += 5; else gameState.cpuScore += 5;
                showPopup(winner==='player'?'„Éà„É©„Ç§ÔºÅÔºÅ':'CPU„Éà„É©„Ç§', '5ÁÇπÁç≤ÂæóÔºÅ„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥„Å∏', true);
                setTimeout(() => { closePopup(); startConversion(winner); }, 2000);
                return true;
            }
            return false;
        }

        function startConversion(team) {
            const success = Math.random() > 0.4;
            showPopup('„Ç≥„É≥„Éê„Éº„Ç∏„Éß„É≥', '„Ç≠„ÉÉ„ÇØ‰∏≠...', false, '<div style="font-size:30px; font-weight:bold;">„Ç≠„ÉÉ„ÇØÊàêÂäü...Ôºü</div>');
            setTimeout(() => {
                showPopup(success ? 'ÊàêÂäüÔºÅ' : 'Â§±Êïó', success ? '+2ÁÇπÁç≤ÂæóÔºÅ' : 'ÂæóÁÇπ„Å™„Çâ„Åö', false);
                if(success) { if(team === 'player') gameState.playerScore += 2; else gameState.cpuScore += 2; }
                setTimeout(() => {
                    closePopup();
                    if (gameState.playerScore >= gameState.targetTries || gameState.cpuScore >= gameState.targetTries) {
                        document.getElementById('gameScreen').style.display = 'none';
                        document.getElementById('victoryScreen').style.display = 'block';
                        document.getElementById('victoryMessage').textContent = gameState.playerScore >= gameState.targetTries ? '„ÅÇ„Å™„Åü„ÅÆÂãùÂà©ÔºÅ' : 'CPU„ÅÆÂãùÂà©';
                    } else { gameState.ballPosition = 50; switchTurn(); startKickoff(); }
                }, 1500);
            }, 1500);
        }

        function switchTurn() { gameState.currentTurn = gameState.currentTurn === 'player' ? 'cpu' : 'player'; updateUI(); startTurn(); }

        function updateUI() {
            document.getElementById('playerScore').textContent = gameState.playerScore;
            document.getElementById('cpuScore').textContent = gameState.cpuScore;
            document.getElementById('ballPosition').style.left = Math.min(Math.max(gameState.ballPosition, 0), 100) + '%';
            document.getElementById('playerScoreBoard').className = `player-score player-side ${gameState.currentTurn === 'player' ? 'active' : ''}`;
            document.getElementById('cpuScoreBoard').className = `player-score cpu-side ${gameState.currentTurn === 'cpu' ? 'active' : ''}`;
        }
    </script>
</body></html>
